/*
    Adapted vulnerability code of
    CVE-ID:     CVE-2018-20996
    RUSTSEC-ID: RUSTSEC-2018-0009
    FROM:       https://github.com/crossbeam-rs/crossbeam-epoch/issues/82
*/

#![feature(start)]

use crossbeam;

#[start]
fn main(_argc: isize, _argv: *const *const u8) -> isize {
    let _ = std::panic::catch_unwind(|| {
        let q = crossbeam::queue::MsQueue::new();
        q.push(DropDetector(1));
        let _ = q.pop();
    });
    0
}

struct DropDetector(u32);

impl Drop for DropDetector {
    fn drop(&mut self) {
        println!("Dropping {}", self.0);
    }
}

